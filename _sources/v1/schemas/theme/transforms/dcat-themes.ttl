@prefix dcterms: <http://purl.org/dc/terms/> .
@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix : <urn:example:shacl#> .

:themeSchemeIdName
  a sh:NodeShape ;
  sh:targetSubjectsOf <https://w3id.org/ogc/stac/themes/schemes> ;
  sh:rule [
		a sh:SPARQLRule ;
		sh:construct """
		    PREFIX stac: <https://w3id.org/ogc/stac/themes/>
		    PREFIX dct: <http://purl.org/dc/terms/>
			CONSTRUCT {
				$this <http://www.w3.org/ns/dcat#theme> ?uriConcept ;
                     dcterms:title  ?conceptName ;
                     dcterms:description ?desc
				 .
			}
			WHERE {
				$this <https://w3id.org/ogc/stac/themes/schemes> ?b .
				?b <https://w3id.org/ogc/stac/themes/concepts> ?concept; <https://w3id.org/ogc/stac/themes/scheme> ?scheme .
				?concept <https://w3id.org/ogc/stac/themes/id> ?conceptId.
				OPTIONAL { ?b stac:name|dcterms:title ?conceptName }.
				OPTIONAL { ?b dcterms:description ?desc }.
				BIND(IRI(CONCAT(?scheme, REPLACE(?conceptId, '.*?::', '/'))) as ?uriConcept)
			}
			""" ;
	] ;
.

:themeSchemeIRI
  a sh:NodeShape ;
  sh:targetSubjectsOf <https://w3id.org/ogc/stac/themes/schemes> ;
  sh:rule [
		a sh:SPARQLRule ;
		sh:construct """
		    PREFIX stac: <https://w3id.org/ogc/stac/themes/>
		    PREFIX dct: <http://purl.org/dc/terms/>
			CONSTRUCT {
				$this <http://www.w3.org/ns/dcat#theme> ?uriConcept ;
				    dcterms:title  ?conceptName ;
				    dcterms:description ?desc .
			}
			WHERE {
				$this <https://w3id.org/ogc/stac/themes/schemes> ?b .
				?b <https://w3id.org/ogc/stac/themes/concepts> ?concept; <https://w3id.org/ogc/stac/themes/scheme> ?scheme .
				OPTIONAL { ?b stac:name|dcterms:title ?conceptName }.
				OPTIONAL { ?b dcterms:description ?desc }.
				FILTER(ISIRI(?concept) && !REGEX(str(?concept), "^https?://") && CONTAINS(str(?concept), "::"))
				BIND(IRI(CONCAT(?scheme, REPLACE(STR(?concept), '.*?::', '/'))) as ?uriConcept)
			}
			""" ;
	] ;
.

:themeConceptIsIRI
  a sh:NodeShape ;
  sh:targetSubjectsOf <https://w3id.org/ogc/stac/themes/schemes> ;
  sh:rule [
		a sh:SPARQLRule ;
		sh:construct """
			PREFIX stac: <https://w3id.org/ogc/stac/themes/>
		    PREFIX dct: <http://purl.org/dc/terms/>
			CONSTRUCT {
				$this <http://www.w3.org/ns/dcat#theme> ?concept ;
				    dcterms:title  ?conceptName ;
				    dcterms:description ?desc.
			}
			WHERE {
				$this <https://w3id.org/ogc/stac/themes/schemes> ?b .
				?b <https://w3id.org/ogc/stac/themes/concepts> ?concept .
				OPTIONAL { ?b stac:name|dcterms:title ?conceptName }.
				OPTIONAL { ?b dcterms:description ?desc }.
				FILTER(ISIRI(?concept) && REGEX(str(?concept), "^https?://"))
			}
			""" ;
	] ;
.